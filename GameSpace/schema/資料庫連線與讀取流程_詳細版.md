# 資料庫連線與資料讀取完整流程 (詳細版)

## 1. 連線資訊
- **伺服器**: DESKTOP-8HQIS1S\SQLEXPRESS
- **資料庫**: GameSpacedatabase
- **認證方式**: Windows 整合認證 (-E 參數)
- **工具**: sqlcmd 命令列工具
- **作業系統**: Windows 11 家用版 (Build 26100)
- **Shell**: PowerShell
- **系統名稱**: DESKTOP-8HQIS1S

## 2. 實際連線命令 (完整版)

### 基本連線格式
`powershell
sqlcmd -S "DESKTOP-8HQIS1S\SQLEXPRESS" -d "GameSpacedatabase" -E -Q "SQL查詢語句"
`

### 參數說明
- -S: 指定伺服器名稱
- -d: 指定資料庫名稱  
- -E: 使用 Windows 整合認證 (不需要使用者名稱和密碼)
- -Q: 執行查詢後退出

## 3. 實際執行的所有命令記錄

### A. Manager 權限相關查詢 (已成功執行)

#### 1. 讀取所有管理員資料
`powershell
sqlcmd -S "DESKTOP-8HQIS1S\SQLEXPRESS" -d "GameSpacedatabase" -E -Q "SELECT * FROM ManagerData"
`
**結果**: 成功讀取 102 個管理員帳號，包含完整的中英文姓名、帳號、密碼、Email、註冊日期

#### 2. 讀取角色權限設定
`powershell
sqlcmd -S "DESKTOP-8HQIS1S\SQLEXPRESS" -d "GameSpacedatabase" -E -Q "SELECT * FROM ManagerRolePermission"
`
**結果**: 成功讀取 8 種角色權限，包含 UserStatusManagement, ShoppingPermissionManagement, Pet_Rights_Management 等

#### 3. 讀取管理員角色分配
`powershell
sqlcmd -S "DESKTOP-8HQIS1S\SQLEXPRESS" -d "GameSpacedatabase" -E -Q "SELECT * FROM ManagerRole"
`
**結果**: 成功讀取 102 個管理員的角色分配記錄

### B. MiniGame Area 相關查詢 (已成功執行)

#### 1. 讀取錢包交易歷史 (前10筆)
`powershell
sqlcmd -S "DESKTOP-8HQIS1S\SQLEXPRESS" -d "GameSpacedatabase" -E -Q "SELECT TOP 10 * FROM WalletHistory"
`
**結果**: 成功讀取錢包交易記錄，包含 ChangeType (Point/Coupon/EVoucher)、ChangeAmount、Description 等

#### 2. 讀取簽到統計 (前10筆)
`powershell
sqlcmd -S "DESKTOP-8HQIS1S\SQLEXPRESS" -d "GameSpacedatabase" -E -Q "SELECT TOP 10 * FROM UserSignInStats"
`
**結果**: 成功讀取簽到記錄，包含 PointsGained、ExpGained、CouponGained、ConsecutiveDays 等

#### 3. 讀取優惠券資料 (前10筆)
`powershell
sqlcmd -S "DESKTOP-8HQIS1S\SQLEXPRESS" -d "GameSpacedatabase" -E -Q "SELECT TOP 10 * FROM Coupon"
`
**結果**: 成功讀取優惠券記錄，包含 CouponCode (格式: CPN-{年月}-{6位隨機碼})、IsUsed、AcquiredTime 等

#### 4. 讀取電子禮券資料 (前10筆)
`powershell
sqlcmd -S "DESKTOP-8HQIS1S\SQLEXPRESS" -d "GameSpacedatabase" -E -Q "SELECT TOP 10 * FROM EVoucher"
`
**結果**: 成功讀取電子禮券記錄，包含 EVoucherCode (格式: EV-{類型代碼}-{4位隨機碼}-{6位數字})、IsUsed、AcquiredTime 等

## 4. 連線成功的重要發現

### Manager 權限系統詳細資料
- **ManagerData 表**: 102 個管理員帳號
  - 關鍵測試帳號：
    - zhang_zhiming_01 (密碼: AdminPass001@) - 最高權限
    - li_xiaohua_02 (密碼: SecurePass002#) - 使用者管理
    - wang_meiling_03 (密碼: StrongPwd003!) - 商城寵物管理
  - 包含完整的中英文姓名、帳號、密碼、Email、註冊日期

- **ManagerRolePermission 表**: 8 種角色權限
  - 角色1：管理者平台管理人員 (最高權限)
  - 角色2：使用者與論壇管理經理
  - 角色3：商城與寵物管理經理
  - 角色4-8：各種專門管理人員

- **ManagerRole 表**: 102 個管理員的角色分配記錄

### MiniGame Area 業務邏輯詳細資料
- **User_Wallet 表**: 會員點數餘額系統
- **WalletHistory 表**: 錢包交易歷史記錄
- **UserSignInStats 表**: 每日簽到統計
- **Pet 表**: 寵物養成系統 (五維屬性、外觀變化、升級機制)
- **MiniGame 表**: 小遊戲記錄 (冒險遊戲、獎勵結算、屬性影響)
- **CouponType 表**: 20 種優惠券類型
- **Coupon 表**: 會員優惠券持有記錄
- **EVoucherType 表**: 20 種電子禮券類型
- **EVoucher 表**: 會員電子禮券持有記錄

## 5. 連線注意事項

### 成功連線的關鍵因素
1. **Windows 整合認證**: 使用 -E 參數，不需要額外的使用者名稱和密碼
2. **伺服器名稱**: 必須使用完整名稱 DESKTOP-8HQIS1S\SQLEXPRESS
3. **資料庫名稱**: 必須使用正確的名稱 GameSpacedatabase
4. **PowerShell 環境**: 在 PowerShell 中執行 sqlcmd 命令
5. **Windows 11 相容性**: 所有命令在 Windows 11 上正常運作

### 查詢結果處理
- 查詢結果會直接顯示在命令列中
- 格式可能較長，建議使用 TOP 10 限制結果數量
- 所有資料表都有完整的種子資料，可以直接用於開發測試

## 6. 驗證連線成功的方法
每次執行命令後，如果成功會顯示：
- 查詢結果的資料
- 最後一行顯示 "(X 個受影響的資料列)"
- 如果失敗會顯示錯誤訊息

## 7. 下一步實作計劃
基於這些實際資料庫資料，可以開始實作 Areas/MiniGame 的完整功能：
1. 建立對應的 Model 類別 (完全對應 SSMS 結構)
2. 實作 Controller 和 Service 層 (完整 CRUD 功能)
3. 建立 Admin 後台頁面 (使用 SB Admin 樣式)
4. 實作權限檢查和業務邏輯 (參考 Manager 權限系統)

## 8. 重要提醒
- 所有查詢都是基於實際的 SSMS 資料庫資料
- 資料表結構、欄位名稱、資料類型都與實際資料庫完全一致
- 種子資料完整，可以直接用於開發和測試
- 權限系統已經完整建立，可以直接用於實作權限檢查
- Windows 11 環境下所有功能正常運作

