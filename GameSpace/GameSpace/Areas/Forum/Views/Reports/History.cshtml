@model List<GameSpace.Areas.Forum.Controllers.ReportsController.DailyIndexVm>
@{
    ViewData["Title"] = "歷史指數查詢";
}

<h2>@ViewData["Title"]</h2>

<!-- 查詢條件區塊 -->
<form method="get" class="row g-3 mb-3">
    <div class="col-md-3">
        <label class="form-label">遊戲</label>
        <!-- 下拉選單，遊戲清單是 Controller 塞進來的 ViewBag.Games -->
        <select name="gameId" class="form-select">
            <option value="">請選擇</option>
            @foreach (var g in ViewBag.Games)
            {
                <option value="@g.GameId" selected="@(ViewBag.GameId == g.GameId ? "selected" : null)">
                    @g.Name
                </option>
            }
        </select>
    </div>
    <div class="col-md-3">
        <label class="form-label">起始日</label>
        <input type="date" name="from" value="@ViewBag.From" class="form-control" />
    </div>
    <div class="col-md-3">
        <label class="form-label">結束日</label>
        <input type="date" name="to" value="@ViewBag.To" class="form-control" />
    </div>
    <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary">查詢</button>
    </div>
</form>

<!-- 結果區塊 -->
@if (Model != null && Model.Any())
{
    <!-- 匯出功能：只有查過資料才會出現 -->
    <div class="mb-2 d-flex gap-2">
        <!-- 匯出 CSV，會帶 gameId/from/to 三個參數 -->
        <a class="btn btn-outline-secondary"
           asp-area="Forum" asp-controller="Reports" asp-action="ExportCsv"
           asp-all-route-data="ViewBag.ExportRoute">匯出 CSV</a>

        <!-- 匯出 Excel，會帶 gameId/from/to 三個參數 -->
        <a class="btn btn-outline-success"
           asp-area="Forum" asp-controller="Reports" asp-action="ExportExcel"
           asp-all-route-data="ViewBag.ExportRoute">匯出 Excel</a>
    </div>

    <!-- 查詢結果表格 -->
    <table class="table table-striped table-sm mt-2">
        <thead>
            <tr>
                <th>日期</th>
                <th>遊戲</th>
                <th>Index</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var r in Model)
            {
                <tr>
                    <td>@r.Date.ToString("yyyy-MM-dd")</td>
                    <td>@r.GameName</td>
                    <td>@r.IndexValue</td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <!-- 如果還沒查過，顯示提示文字 -->
    <p class="text-muted">請先選擇條件查詢。</p>
}