@model GameSpace.Models.CouponType

<div class="mb-3">
    <label asp-for="Name" class="form-label">名稱</label>
    <input asp-for="Name" class="form-control" />
    <span asp-validation-for="Name" class="text-danger"></span>
</div>

<div class="row g-3">
    <div class="col-md-6">
        <label asp-for="DiscountType" class="form-label">折扣類型</label>
        <select asp-for="DiscountType" class="form-select" id="discountType">
            <option value="">— 請選擇 —</option>
            <option value="Amount">Amount（固定金額）</option>
            <option value="Percent">Percent（百分比 0~1，例如 0.15=85 折）</option>
        </select>
        <span asp-validation-for="DiscountType" class="text-danger"></span>
        <div class="form-text">只接受 <code>Amount</code> 或 <code>Percent</code>。</div>
    </div>
    <div class="col-md-6">
        <label asp-for="DiscountValue" class="form-label">折扣值</label>
        <input asp-for="DiscountValue" class="form-control" step="0.01" placeholder="Amount 例：100；Percent 例：0.15" id="discountValue" />
        <span asp-validation-for="DiscountValue" class="text-danger"></span>
        <div class="form-text" id="dvHelp">Percent：介於 0 與 1；Amount：≥ 0。</div>
    </div>
</div>

<div class="row g-3 mt-0">
    <div class="col-md-6">
        <label asp-for="MinSpend" class="form-label">最低消費</label>
        <input asp-for="MinSpend" class="form-control" step="0.01" />
        <span asp-validation-for="MinSpend" class="text-danger"></span>
    </div>
    <div class="col-md-6">
        <label asp-for="PointsCost" class="form-label">點數成本</label>
        <input asp-for="PointsCost" class="form-control" />
        <span asp-validation-for="PointsCost" class="text-danger"></span>
    </div>
</div>

<div class="row g-3 mt-0">
    <div class="col-md-6">
        <label asp-for="ValidFrom" class="form-label">有效起</label>
        <input asp-for="ValidFrom" type="datetime-local" asp-format="{0:yyyy-MM-ddTHH:mm}" class="form-control" />
        <span asp-validation-for="ValidFrom" class="text-danger"></span>
    </div>
    <div class="col-md-6">
        <label asp-for="ValidTo" class="form-label">有效迄</label>
        <input asp-for="ValidTo" type="datetime-local" asp-format="{0:yyyy-MM-ddTHH:mm}" class="form-control" />
        <span asp-validation-for="ValidTo" class="text-danger"></span>
        <div class="form-text">不得早於「有效起」。</div>
    </div>
</div>

<div class="mb-3 mt-3">
    <label asp-for="Description" class="form-label">描述</label>
    <textarea asp-for="Description" class="form-control" rows="3"></textarea>
    <span asp-validation-for="Description" class="text-danger"></span>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            const $type = document.getElementById('discountType');
            const $val = document.getElementById('discountValue');
            const $help = document.getElementById('dvHelp');

            function sync() {
                const t = ($type?.value || '').toLowerCase();
                if (t === 'percent') {
                    $val?.setAttribute('step', '0.01');
                    $val?.setAttribute('placeholder', '輸入 0~1，如 0.15 代表 85 折');
                    $help && ($help.textContent = 'Percent：介於 0 與 1；Amount：≥ 0。');
                } else if (t === 'amount') {
                    $val?.setAttribute('step', '0.01');
                    $val?.setAttribute('placeholder', '輸入固定金額，如 100');
                    $help && ($help.textContent = 'Amount：≥ 0；Percent：介於 0 與 1。');
                } else {
                    $val?.removeAttribute('step');
                    $val?.setAttribute('placeholder', 'Amount 例：100；Percent 例：0.15');
                    $help && ($help.textContent = 'Percent：介於 0 與 1；Amount：≥ 0。');
                }
            }

            $type?.addEventListener('change', sync);
            sync();
        })();
    </script>
}
