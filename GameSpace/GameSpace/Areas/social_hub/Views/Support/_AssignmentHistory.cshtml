@model IEnumerable<GameSpace.Models.SupportTicketAssignment>

@{
    var list = Model?.ToList() ?? new List<GameSpace.Models.SupportTicketAssignment>();
    var hasItems = list.Count > 0;
    var tid = hasItems ? list[0].TicketId : (int)(ViewBag.TicketId ?? 0);
    var curPage = (int)(ViewBag.Page ?? 1);         // 避免與 Razor 的 @page 保留字衝突
    var totalPages = (int)(ViewBag.TotalPages ?? 1);
}

@if (!hasItems)
{
    <div class="text-muted">尚無歷史紀錄。</div>
}
else
{
    <ul class="list-group list-group-flush small">
        @foreach (var a in list)
        {
            <li class="list-group-item d-flex justify-content-between align-items-center px-0 py-1">
                <div class="d-flex align-items-center gap-2">
                    <span class="text-muted">客服</span>
                    <span class="fw-semibold">@a.ToManagerId</span>
                    <span class="text-muted">·</span>
                    <!-- ★ 用 App 時區顯示（台灣），DB 仍存 UTC -->
                    <span class="text-nowrap">@Html.AppTime(a.AssignedAt, "yyyy/MM/dd HH:mm")</span>
                </div>
                <a class="btn btn-sm btn-outline-primary"
                   href="@Url.Action("AssignmentConversation", "Support", new { area = "social_hub", id = tid, aid = a.AssignmentId })">
                    查看對話
                </a>
            </li>
        }
    </ul>

    @if (totalPages > 1)
    {
        <nav class="mt-2" aria-label="Assignment pagination">
            <ul class="pagination pagination-sm mb-0">
                <li class="page-item @(curPage > 1 ? "" : "disabled")">
                    <a class="page-link"
                       href="@Url.Action("AssignmentHistory", new { id = tid, page = curPage - 1 })">上一頁</a>
                </li>
                <li class="page-item disabled">
                    <span class="page-link">@curPage / @totalPages</span>
                </li>
                <li class="page-item @(curPage < totalPages ? "" : "disabled")">
                    <a class="page-link"
                       href="@Url.Action("AssignmentHistory", new { id = tid, page = curPage + 1 })">下一頁</a>
                </li>
            </ul>
        </nav>
    }
}
