@model GameSpace.Areas.social_hub.Models.ViewModels.AssignmentHistoryPageVM

@{
    ViewData["Title"] = $"指派歷史 - 工單 #{Model.TicketId}";
}

@section Styles {
    <style>
        .ahp .table-zone {
            overflow: hidden;
        }

        .ahp table.table > :not(caption) > * > * {
            padding: .4rem .5rem;
        }
        /* 壓列高 */
        .ahp .head-summary {
            color: #6c757d;
        }

        .ahp .pagination-wrap {
            display: flex;
            justify-content: flex-end;
        }
    </style>
}

<a class="btn btn-link mb-2" href="@Url.Action("Ticket", new { id = Model.TicketId })">← 返回工單</a>

<div class="card shadow-sm ahp">
    <div class="card-header d-flex justify-content-between align-items-center">
        <strong>工單 #@Model.TicketId 指派歷史</strong>
        <span class="head-summary small">使用者ID：@Model.UserId　主旨：@Model.Subject</span>
    </div>

    <div class="card-body">
        @if (Model.Items == null || Model.Items.Count == 0)
        {
            <div class="text-muted">尚無指派紀錄。</div>
        }
        else
        {
            <div class="table-zone table-responsive">
                <table class="table table-sm align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 160px;">當初的客服</th>
                            <th style="width: 160px;">元客服</th>
                            <th style="width: 160px;">由誰轉單</th>
                            <th style="width: 180px;">轉單時間</th>
                            <th style="width: 120px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var a in Model.Items)
                        {
                            <tr>
                                <td>@a.ToManagerId</td>
                                <td>@(a.FromManagerId?.ToString() ?? "未指派")</td>
                                <td>@(a.AssignedByManagerId?.ToString() ?? "—")</td>
                                <td>@Html.AppTime(a.AssignedAt, "yyyy/MM/dd HH:mm")</td>
                                <td class="text-end">
                                    <a class="btn btn-sm btn-outline-primary"
                                       href="@Url.Action("AssignmentConversation", "Support", new { area = "social_hub", id = Model.TicketId, aid = a.AssignmentId })">
                                        對話
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="d-flex align-items-center mt-2">
                <div class="small text-muted">
                    第 @Model.Page / @Model.TotalPages 頁　·　共 @Model.TotalCount 筆　·　每頁 @Model.PageSize 筆
                </div>
                <div class="ms-auto pagination-wrap">
                    <ul class="pagination pagination-sm mb-0">
                        <li class="page-item @(Model.HasPrev ? "" : "disabled")">
                            <a class="page-link" href="@Url.Action("AssignmentHistoryPage", "Support", new { area = "social_hub", id = Model.TicketId, page = Model.Page - 1 })">上一頁</a>
                        </li>
                        @{
                            var start = Math.Max(1, Model.Page - 2);
                            var end = Math.Min(Model.TotalPages, Model.Page + 2);
                            for (var p = start; p <= end; p++)
                            {
                                <li class="page-item @(p == Model.Page ? "active" : "")">
                                    <a class="page-link" href="@Url.Action("AssignmentHistoryPage", "Support", new { area = "social_hub", id = Model.TicketId, page = p })">@p</a>
                                </li>
                            }
                        }
                        <li class="page-item @(Model.HasNext ? "" : "disabled")">
                            <a class="page-link" href="@Url.Action("AssignmentHistoryPage", "Support", new { area = "social_hub", id = Model.TicketId, page = Model.Page + 1 })">下一頁</a>
                        </li>
                    </ul>
                </div>
            </div>
        }
    </div>
</div>
