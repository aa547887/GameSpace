@model GameSpace.Areas.social_hub.Models.ViewModels.AssignmentHistoryPageVM
@{
    ViewData["Title"] = $"指派歷史 - 工單 #{Model.TicketId}";
}

<a class="btn btn-link mb-2" href="@Url.Action("Ticket", new { id = Model.TicketId })">← 返回工單</a>

<div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
        <strong>工單 #@Model.TicketId 指派歷史</strong>
        <span class="text-muted small">使用者ID：@Model.UserId　主旨：@Model.Subject</span>
    </div>
    <div class="card-body">
        @if (Model.Items == null || Model.Items.Count == 0)
        {
            <div class="text-muted">尚無指派紀錄。</div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-sm align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 160px;">當初的客服</th>
                            <th style="width: 160px;">元客服</th>
                            <th style="width: 160px;">由誰轉單</th>
                            <th style="width: 180px;">轉單時間</th>
                            <th style="width: 120px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var a in Model.Items)
                        {
                            <tr>
                                <!-- 當次指派後的負責人 -->
                                <td>@a.ToManagerId</td>

                                <!-- 來源客服（可能為 null＝未指派） -->
                                <td>@(a.FromManagerId?.ToString() ?? "未指派")</td>

                                <!-- 執行轉派的人（可能為 null） -->
                                <td>@(a.AssignedByManagerId?.ToString() ?? "—")</td>

                                <!-- 指派時間 -->
                                <td>@a.AssignedAt.ToString("yyyy/MM/dd HH:mm")</td>

                                <td class="text-end">
                                    <a class="btn btn-sm btn-outline-primary"
                                       href="@Url.Action("AssignmentConversation", "Support", new { area = "social_hub", id = Model.TicketId, aid = a.AssignmentId })">
                                        對話
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>
