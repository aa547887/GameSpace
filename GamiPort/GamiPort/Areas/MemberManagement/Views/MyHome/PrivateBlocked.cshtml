@* =========================
   Home 小屋頁（不公開版）— 詳細註解
   說明：此檔案顯示個人小屋頁面，但目前以「不公開」提示卡片取代主內容。
   只加註解，不改任何邏輯／標記／JS 流程。
   ========================= *@

@model GamiPort.Areas.MemberManagement.ViewModels.HomePageVM

@* 目前僅用於從 Claims 取出使用者識別；若系統 Identity 使用 GUID（常見），int.Parse 會有風險，見下方 NOTE *@
@using System.Security.Claims

@{
    // 頁面標題：使用者暱稱 + 固定字樣
    ViewData["Title"] = $"{Model.UserNickName} 的小屋";

    // 指定佈局頁；請確認對應 Layout 存在於指定路徑
    Layout = "~/Areas/MemberManagement/Views/Shared/_Layout.cshtml";

    // 目前登入者的使用者 ID（操作者）
    // NOTE：這裡假設 ClaimTypes.NameIdentifier 可被解析成「整數」字串。
    // 若你的系統用 ASP.NET Identity 預設 GUID，此處 int.Parse 會拋例外。
    // 建議在 Controller 先把 ActorUserId（int?）放進 ViewModel，View 就不要解析 Claims。
    var currentLoggedInUserId = User.Identity.IsAuthenticated
        ? int.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? "0")
        : 0;

    // 小屋主（被造訪者）的 UserId
    var targetUserId = Model.OwnerUserId;
}

<div class="container py-3" style="max-width: 1000px;">
    @* ===== 頁首：暱稱與造訪次數 ===== *@
    <div class="mb-2 d-flex align-items-center justify-content-center text-center">
        <div class="fs-5 fw-semibold">
            <span class="me-2 fw-semibold">@Model.UserNickName 的小屋</span>
            <small class="text-muted">被造訪次數：@Model.VisitCount</small>
        </div>
    </div>

    @* ===== 背景圖／頭像區 =====
       - 背景圖以 object-fit: cover 填滿，避免比例變形
       - 頭像以圓形呈現並覆蓋在背景圖下緣（position-absolute）
       ======================= *@
    <div class="position-relative border rounded overflow-hidden mb-3">
        <img src="@Model.ThemeSrc" alt="Theme" class="w-100" style="height: 200px; object-fit: cover;" />
        <div class="position-absolute" style="left: 16px; bottom: -32px;">
            <img src="@Model.UserPictureSrc" alt="UserPicture"
                 class="rounded-circle border bg-white"
                 style="width: 96px; height: 96px; object-fit: cover;" />
        </div>
    </div>

    @* Anti-Forgery 隱藏欄位：relation.js / notify.js 會從 DOM 中取出並附加在 AJAX 請求 *@
    @Html.AntiForgeryToken()

    @* 狀態提示（除錯用途）：顯示 Working / Result / Error 等字樣  (先不顯示)*@
    @* <div id="rel-status" class="mt-3 small text-muted"></div> *@

    @* 交友操作按鈕列（由 JS 動態插入）；若為本人或未登入則不顯示 *@
    <div id="relation-action-bar" class="d-flex justify-content-end gap-2 mt-2 p-2"></div>

    @* ===== 不公開提示卡片 =====
       - 目前不顯示貼文／好友等內容，僅顯示鎖頭提示
       - 使用了 Bootstrap Icons 的鎖頭圖示（bi-lock-fill），請確認版型已引用 bootstrap-icons
       ================================================= *@
    <div class="card text-center shadow-sm border-danger">
        <div class="card-body py-5">
            <h5 class="fw-semibold text-danger mb-3">
                <i class="bi bi-lock-fill"></i> 此小屋目前設定為不公開
            </h5>
            <p class="text-muted mb-0">
                僅屋主本人可查看貼文、好友清單與其他互動內容。
            </p>
        </div>
    </div>
</div>
