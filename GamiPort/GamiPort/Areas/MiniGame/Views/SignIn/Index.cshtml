@using GamiPort.Areas.MiniGame.Controllers
@using GamiPort.Areas.MiniGame.Helpers
@model SignInIndexViewModel

@{
	ViewData["Title"] = "簽到";
	var currentMonth = Model.CurrentMonth;
	var currentYear = Model.CurrentYear;
}

<div class="container my-5">
	<div class="row">
		<!-- 簽到狀態卡片 -->
		<div class="col-md-4 mb-4">
			<div class="card" style="border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
				<div class="card-body" style="background: linear-gradient(135deg, #17a2b8 0%, #0d9488 100%); color: white; border-radius: 16px;">
					<h5 class="card-title mb-3">簽到狀態</h5>

					<div class="row mb-3">
						<div class="col-6">
							<div class="text-center">
								<div style="font-size: 32px; font-weight: bold;">@Model.Status.CurrentConsecutiveDays</div>
								<div style="font-size: 12px; opacity: 0.9;">連續簽到天數</div>
							</div>
						</div>
						<div class="col-6">
							<div class="text-center">
								<div style="font-size: 32px; font-weight: bold;">@Model.Status.TotalSignInDays</div>
								<div style="font-size: 12px; opacity: 0.9;">總簽到天數</div>
							</div>
						</div>
					</div>

					<hr style="background-color: rgba(255,255,255,0.3);" />

					@if (Model.Status.IsSignedInToday)
					{
						<div class="alert alert-success mb-3">
							<i class="fas fa-check-circle"></i> 今天已簽到
						</div>
					}
					else
					{
						<form method="post" action="@Url.Action("CheckIn")">
							<button type="submit" class="btn btn-warning w-100" style="font-weight: bold;">
								<i class="fas fa-pencil-alt"></i> 立即簽到
							</button>
						</form>

						<div class="alert alert-info mt-3 mb-0">
							<strong>今日獎勵：</strong>
							<ul class="mb-0">
								<li>點數: @Model.Status.TodayPoints</li>
								<li>經驗: @Model.Status.TodayExperience</li>
								@if (Model.Status.TodayHasCoupon)
								{
									<li><i class="fas fa-gift"></i> 優惠券</li>
								}
							</ul>
						</div>
					}
				</div>
			</div>
		</div>

		<!-- 月曆 -->
		<div class="col-md-8">
			<div class="card" style="border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
				<div class="card-body">
					<div class="d-flex justify-content-between align-items-center mb-4">
						<h5 class="card-title mb-0">@currentYear 年 @currentMonth 月簽到日曆</h5>
						<div>
							<a href="@Url.Action("Index", new { year = currentYear, month = currentMonth > 1 ? currentMonth - 1 : 12 })"
							   class="btn btn-sm btn-outline-secondary">
								<i class="fas fa-chevron-left"></i> 上月
							</a>
							<a href="@Url.Action("Index", new { year = currentYear, month = currentMonth < 12 ? currentMonth + 1 : 1 })"
							   class="btn btn-sm btn-outline-secondary">
								下月 <i class="fas fa-chevron-right"></i>
							</a>
						</div>
					</div>

					<div class="table-responsive">
						<table class="table table-bordered text-center">
							<thead style="background-color: #f0f4f8;">
								<tr>
									<th>日</th>
									<th>一</th>
									<th>二</th>
									<th>三</th>
									<th>四</th>
									<th>五</th>
									<th>六</th>
								</tr>
							</thead>
							<tbody>
								@{
									var daysInMonth = Model.Calendar.Days.Count;
									var firstDay = new DateTime(currentYear, currentMonth, 1).DayOfWeek;
									var startCol = (int)firstDay;
									var dayIndex = 0;

									for (int week = 0; week < 6 && dayIndex < daysInMonth; week++)
									{
										<tr>
											@for (int col = 0; col < 7 && dayIndex < daysInMonth; col++)
											{
												if (week == 0 && col < startCol)
												{
													<td></td>
												}
												else
												{
													var day = Model.Calendar.Days[dayIndex];
													var bgColor = day.IsSignedIn ? "#e0f2f1" : "#ffffff";
													var borderColor = day.IsSignedIn ? "#17a2b8" : "#ddd";

													<td style="background-color: @bgColor; border: 2px solid @borderColor; padding: 12px; border-radius: 8px;">
														<strong>@day.Day</strong>
														@if (day.IsSignedIn)
														{
															<div style="font-size: 11px; color: #17a2b8; margin-top: 4px;">
																<i class="fas fa-check-circle"></i> 已簽到
															</div>
															@if (day.PointsGained.HasValue)
															{
																<div style="font-size: 10px; color: #666;">+@day.PointsGained P</div>
															}
														}
													</td>

													dayIndex++;
												}
											}
										</tr>
									}
								}
							</tbody>
						</table>
					</div>

					<div class="mt-3 text-center">
						<a href="@Url.Action("History")" class="btn btn-primary" style="background-color: #17a2b8; border-color: #17a2b8;">
							<i class="fas fa-history"></i> 查看簽到歷史
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	.container {
		max-width: 1200px;
	}

	.card {
		border: none;
		transition: box-shadow 0.3s ease;
	}

	.card:hover {
		box-shadow: 0 8px 16px rgba(0,0,0,0.12) !important;
	}

	.btn {
		transition: all 0.2s ease;
	}

	.btn:hover {
		transform: translateY(-2px);
	}
</style>
